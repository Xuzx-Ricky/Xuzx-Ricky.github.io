let yzf={};yzf.showRightMenu=function(e,n=0,t=0){var o=$("#rightMenu");e?(o.css("top",n+"px").css("left",t+"px"),o.show()):o.hide()};var readmode,selectTextNow="";function selceText(){var e=document.selection?document.selection.createRange().text:window.getSelection()+"";selectTextNow=e||""}function RemoveRightMenu(){yzf.showRightMenu(!1),$("#rightmenu-mask").attr("style","display: none")}function imageToBlob(e){let t=new Image,o=document.createElement("canvas"),i=o.getContext("2d");t.crossOrigin="*";try{t.src=e}catch(e){console.log(e)}return new Promise(n=>{t.onerror=function(){n(e)},t.onload=function(){o.width=this.naturalWidth,o.height=this.naturalHeight,i.drawImage(this,0,0),o.toBlob(e=>{n(e)},"image/png",.75)}})}async function copyImage(e){var n=await imageToBlob(e);n instanceof Blob?(n=new ClipboardItem({"image/png":n}),navigator.clipboard.write([n])):navigator.clipboard.writeText(e)}document.onmouseup=document.ondbclick=selceText,window.oncontextmenu=function(o){if($("#rightMenu").is(":visible"))RemoveRightMenu();else{var i=$("#menu-copytext"),c=$("#menu-pastetext"),a=$(".rightMenuOther"),l=$("#menu-copylink"),r=$("#menu-newwindow"),u=$(".menu-search"),m=$("#menu-copyimg"),s=$("#menu-downloadimg"),d=$("#menu-readmode"),h=o.target.href,g=o.target.currentSrc;let e=!1;globalEvent=o,a.show(),selectTextNow&&window.getSelection()?(e=!0,i.show(),u.show()):(i.hide(),u.hide()),0<$("thisisanarticle").length&&$("thisisfof").length<=0?d.show():d.hide(),"input"===o.target.tagName.toLowerCase()||"textarea"===o.target.tagName.toLowerCase()?(e=!0,c.show()):c.hide(),h?(e=!0,r.show(),l.show(),domhref=h):(r.hide(),l.hide()),g?(e=!0,m.show(),s.show(),domImgSrc=g):(m.hide(),s.hide()),e?a.show():a.hide(),$(".rightMenu-line.rightMenu-music").html($(".aplayer-title").html());i=$("#rightMenu").width(),u=$("#rightMenu").height();let n=o.clientX+10,t=o.clientY;n+i>window.innerWidth&&(n-=i),t+u>window.innerHeight&&(t-=t+u-window.innerHeight),yzf.showRightMenu(!0,t,n),$("#rightmenu-mask").attr("style","display: flex")}return!1},yzf.rightmenuCopyText=function(e){navigator.clipboard&&navigator.clipboard.writeText(e)},yzf.readClipboard=function(){navigator.clipboard&&navigator.clipboard.readText().then(e=>yzf.insertAtCaret(globalEvent.target,e))},yzf.insertAtCaret=function(e,n){var t,o=e.selectionStart,i=e.selectionEnd;document.selection?(e.focus(),document.selection.createRange().text=n,e.focus()):o||"0"==o?(t=e.scrollTop,e.value=e.value.substring(0,o)+n+e.value.substring(i,e.value.length),e.focus(),e.selectionStart=o+n.length,e.selectionEnd=o+n.length,e.scrollTop=t):(e.value+=n,e.focus())},yzf.pasteText=function(){yzf.readClipboard();RemoveRightMenu()},yzf.copyLink=function(){yzf.rightmenuCopyText(domhref),RemoveRightMenu()},yzf.downloadimging=!1,yzf.downloadImage=function(e){var n;RemoveRightMenu(),0==yzf.downloadimging&&(yzf.downloadimging=!0,a=document.createElement("a"),n=new MouseEvent("click"),a.download="",a.href=e,a.target="_blank",a.dispatchEvent(n),yzf.downloadimging=!1)},yzf.writeClipImg=function(e){RemoveRightMenu(),0==yzf.downloadimging&&(yzf.downloadimging=!0,copyImage(e),yzf.downloadimging=!1)},$("#menu-pastetext").on("click",yzf.pasteText),$("#menu-backward").on("click",function(){window.history.back(),RemoveRightMenu()}),$("#menu-forward").on("click",function(){window.history.forward(),RemoveRightMenu()}),$("#menu-refresh").on("click",function(){window.location.reload(),RemoveRightMenu()}),yzf.switchDarkMode=function(){RemoveRightMenu(),document.querySelector("a[title='主题切换']").click()},yzf.readmode=function(){if(readmode&&"readmode"!==new URLSearchParams(window.location.search).get("type")){document.querySelector(".column-left").style="",document.querySelector(".column-right").style="",document.querySelector(".columns").style="",$("nav").css("display",""),$("footer").css("display","");try{document.querySelector("#waline-thread").parentElement.parentElement.style.display=""}catch(e){}$("#back-to-top").css("display",""),$("section").unbind("click"),$(".column.column-main").addClass("is-8-tablet is-8-desktop is-6-widescreen"),$(".column.column-main").removeClass("is-10-widescreen"),readmode=!1}else{document.querySelector(".column-left").style="display:none",document.querySelector(".column-right").style="display:none",document.querySelector(".columns").style="justify-content: center;",$("nav").css("display","none"),$("footer").css("display","none");try{document.querySelector("#waline-thread").parentElement.parentElement.style.display="none"}catch(e){}$("#back-to-top").css("display","none"),$("section").on("click",function(e){e=(e=e||window.event).target;$(e).is(".columns .column")||$(e).is(".columns .column *")||yzf.readmode()}),$(".column.column-main").removeClass("is-8-tablet is-8-desktop is-6-widescreen"),$(".column.column-main").addClass("is-10-widescreen"),readmode=!0}},$("#menu-darkmode").on("click",yzf.switchDarkMode),$("#menu-up").on("click",function(){document.querySelector("#back-to-top").click(),RemoveRightMenu()}),$("#menu-copytext").on("click",function(){yzf.rightmenuCopyText(selectTextNow),RemoveRightMenu()}),$("#menu-copylink").on("click",yzf.copyLink),$("#menu-newwindow").on("click",function(){window.open(domhref),RemoveRightMenu()}),$("#menu-about").on("click",()=>{document.querySelector("a[href='/about/']").click(),RemoveRightMenu()}),$("#menu-links").on("click",()=>{document.querySelector("a[href='/links/']").click(),RemoveRightMenu()}),$("#menu-lrc").on("click",()=>{document.querySelector(".aplayer-icon.aplayer-icon-lrc").click(),RemoveRightMenu()}),$("#menu-startMic").on("click",()=>{ap.play(),RemoveRightMenu()}),$("#menu-stopMic").on("click",()=>{ap.pause(),RemoveRightMenu()}),$("#menu-nextMic").on("click",()=>{addsong(),ap.play(),RemoveRightMenu()}),$("#menu-downloadimg").on("click",function(){yzf.downloadImage(domImgSrc)}),$("#menu-copyimg").on("click",function(){yzf.writeClipImg(domImgSrc)}),$("#menu-search-baidu").on("click",function(){window.open("https://www.baidu.com/s?wd="+selectTextNow),RemoveRightMenu()}),$("#menu-search-bing").on("click",function(){window.open("https://cn.bing.com/search?q="+selectTextNow),RemoveRightMenu()}),$("#menu-readmode").on("click",function(){yzf.readmode(),RemoveRightMenu()}),"readmode"===new URLSearchParams(window.location.search).get("type")&&0<$("thisisanarticle").length&&$("thisisfof").length<=0&&(yzf.readmode(),$("#rightMenu").remove(),document.querySelectorAll("a[href]").forEach(t=>{t.addEventListener("click",async e=>{var n=t.getAttribute("href"),e=(e.preventDefault(),document.createElement("a"));e.href=n,e.target="_blank",e.click()})}));